(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))l(a);new MutationObserver(a=>{for(const o of a)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&l(r)}).observe(document,{childList:!0,subtree:!0});function h(a){const o={};return a.integrity&&(o.integrity=a.integrity),a.referrerpolicy&&(o.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?o.credentials="include":a.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function l(a){if(a.ep)return;a.ep=!0;const o=h(a);fetch(a.href,o)}})();class P{constructor(e,h,l,a,o){this.x=e,this.y=h,this.width=l,this.height=a,this.speed=o,this.direction=f,this.nextDirection=this.direction,this.frameCount=7,this.currentFrame=1,setInterval(()=>{this.changeAnimation()},100)}moveProcess(){this.changeDirectionIfPossible(),this.moveForwards(),this.checkCollisions()&&this.moveBackwards()}eat(){for(let e=0;e<s.length;e++)for(let h=0;h<s[0].length;h++)s[e][h]===2&&this.getMapX()===h&&this.getMapY()===e&&(s[e][h]=3,b++)}moveBackwards(){switch(this.direction){case f:this.x-=this.speed;break;case x:this.y+=this.speed;break;case y:this.x+=this.speed;break;case w:this.y-=this.speed;break}}moveForwards(){switch(this.direction){case f:this.x+=this.speed;break;case x:this.y-=this.speed;break;case y:this.x-=this.speed;break;case w:this.y+=this.speed;break}}checkCollisions(){return s[this.getMapY()][this.getMapX()]===1||s[this.getMapYRightSide()][this.getMapX()]===1||s[this.getMapY()][this.getMapXRightSide()]===1||s[this.getMapYRightSide()][this.getMapXRightSide()]===1}checkGhostCollision(){for(let e=0;e<m.length;e++){let h=m[e];if(h.getMapX()===this.getMapX()&&h.getMapY()===this.getMapY())return!0}return!1}changeDirectionIfPossible(){if(this.direction===this.nextDirection)return;let e=this.direction;this.direction=this.nextDirection,this.moveForwards(),this.checkCollisions()?(this.moveBackwards(),this.direction=e):this.moveBackwards()}changeAnimation(){this.currentFrame=this.currentFrame===this.frameCount?1:this.currentFrame+1}draw(){n.save(),n.translate(this.x+t/2,this.y+t/2),n.rotate(this.direction*90*Math.PI/180),n.translate(-this.x-t/2,-this.y-t/2),n.drawImage(D,(this.currentFrame-1)*t,0,t,t,this.x,this.y,this.width,this.height),n.restore()}getMapX(){return parseInt(this.x/t)}getMapY(){return parseInt(this.y/t)}getMapXRightSide(){return parseInt((this.x+.99*t)/t)}getMapYRightSide(){return parseInt((this.y+.99*t)/t)}}class B{constructor(e,h,l,a,o,r,p,v,O,E){this.x=e,this.y=h,this.width=l,this.height=a,this.speed=o,this.direction=f,this.imageX=r,this.imageY=p,this.imageHeight=O,this.imageWidth=v,this.range=E,this.randomTargetIndex=parseInt(Math.random()*C.length),setInterval(()=>{this.changeRandomDirection()},1e4)}isInRangeOfPacman(){let e=Math.abs(c.getMapX()-this.getMapX()),h=Math.abs(c.getMapY()-this.getMapY());return Math.sqrt(e*e+h*h)<=this.range}changeRandomDirection(){this.randomTargetIndex+=1,this.randomTargetIndex=this.randomTargetIndex%4}moveProcess(){if(this.isInRangeOfPacman()?this.target=c:this.target=C[this.randomTargetIndex],this.changeDirectionIfPossible(),this.moveForwards(),this.checkCollisions()){this.moveBackwards();return}}moveBackwards(){switch(this.direction){case f:this.x-=this.speed;break;case x:this.y+=this.speed;break;case y:this.x+=this.speed;break;case w:this.y-=this.speed;break}}moveForwards(){switch(this.direction){case f:this.x+=this.speed;break;case x:this.y-=this.speed;break;case y:this.x-=this.speed;break;case w:this.y+=this.speed;break}}checkCollisions(){return s[this.getMapY()][this.getMapX()]===1||s[this.getMapYRightSide()][this.getMapX()]===1||s[this.getMapY()][this.getMapXRightSide()]===1||s[this.getMapYRightSide()][this.getMapXRightSide()]===1}changeDirectionIfPossible(){let e=this.direction;if(this.direction=this.calculateNewDirection(s,parseInt(this.target.x/t),parseInt(this.target.y/t)),typeof this.direction>"u"){this.direction=e;return}this.moveForwards(),this.checkCollisions()?(this.moveBackwards(),this.direction=e):this.moveBackwards()}calculateNewDirection(e,h,l){let a=[];for(let r=0;r<e.length;r++)a[r]=e[r].slice();let o=[{x:this.getMapX(),y:this.getMapY(),rightX:this.getMapXRightSide(),rightY:this.getMapYRightSide(),moves:[]}];for(;o.length>0;){let r=o.shift();if(r.x===h&&r.y===l)return r.moves[0];{a[r.y][r.x]=1;let p=this.addNeighbors(r,a);for(let v=0;v<p.length;v++)o.push(p[v])}}return x}addNeighbors(e,h){let l=[],a=h.length,o=h[0].length;if(e.x-1>=0&&e.x-1<a&&h[e.y][e.x-1]!==1){let r=e.moves.slice();r.push(y),l.push({x:e.x-1,y:e.y,moves:r})}if(e.x+1>=0&&e.x+1<a&&h[e.y][e.x+1]!==1){let r=e.moves.slice();r.push(f),l.push({x:e.x+1,y:e.y,moves:r})}if(e.y-1>=0&&e.y-1<o&&h[e.y-1][e.x]!==1){let r=e.moves.slice();r.push(x),l.push({x:e.x,y:e.y-1,moves:r})}if(e.y+1>=0&&e.y+1<o&&h[e.y+1][e.x]!==1){let r=e.moves.slice();r.push(w),l.push({x:e.x,y:e.y+1,moves:r})}return l}changeAnimation(){this.currentFrame=this.currentFrame===this.frameCount?1:this.currentFrame+1}draw(){n.save(),n.drawImage(N,this.imageX,this.imageY,this.imageWidth,this.imageHeight,this.x,this.y,this.width,this.height),n.restore()}getMapX(){return parseInt(this.x/t)}getMapY(){return parseInt(this.y/t)}getMapXRightSide(){return parseInt((this.x+.99*t)/t)}getMapYRightSide(){return parseInt((this.y+.99*t)/t)}}const I=document.getElementById("canvas"),n=I.getContext("2d"),L=new FontFace("Emulogic","url(assets/font/emulogic.ttf)");L.load().then(i=>{document.fonts.add(i)});const D=document.getElementById("animations"),N=document.getElementById("ghosts");let u=(i,e,h,l,a)=>{n.fillStyle=a,n.fillRect(i,e,h,l)},c,m=[],G=4,W=30,t=20,j="#342DCa",d=t/1.5,g=(t-d)/2,M="black",q="#FEB897",b=0,k=3,S=0;const f=4,x=3,y=2,w=1;let R=[{x:0,y:0},{x:176,y:0},{x:0,y:121},{x:176,y:121}],s=[[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1],[1,2,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,2,1,1,1,1,1,2,1,2,1,1,1,2,1],[1,2,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,2,1],[1,1,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,1,1],[0,0,0,0,1,2,1,2,2,2,2,2,2,2,1,2,1,0,0,0,0],[1,1,1,1,1,2,1,2,1,1,2,1,1,2,1,2,1,1,1,1,1],[1,2,2,2,2,2,2,2,1,2,2,2,1,2,2,2,2,2,2,2,1],[1,1,1,1,1,2,1,2,1,2,2,2,1,2,1,2,1,1,1,1,1],[0,0,0,0,1,2,1,2,1,1,1,1,1,2,1,2,1,0,0,0,0],[0,0,0,0,1,2,1,2,2,2,2,2,2,2,1,2,1,0,0,0,0],[1,1,1,1,1,2,2,2,1,1,1,1,1,2,2,2,1,1,1,1,1],[1,2,2,2,2,2,2,2,2,2,1,2,2,2,2,2,2,2,2,2,1],[1,2,1,1,1,2,1,1,1,2,1,2,1,1,1,2,1,1,1,2,1],[1,2,2,2,1,2,2,2,2,2,1,2,2,2,2,2,1,2,2,2,1],[1,1,2,2,1,2,1,2,1,1,1,1,1,2,1,2,1,2,2,1,1],[1,2,2,2,2,2,1,2,2,2,1,2,2,2,1,2,2,2,2,2,1],[1,2,1,1,1,1,1,1,1,2,1,2,1,1,1,1,1,1,1,2,1],[1,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,2,1],[1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]];for(let i=0;i<s.length;i++)for(let e=0;e<s[0].length;e++)s[i][e]===2&&S++;let C=[{x:1*t,y:1*t},{x:1*t,y:(s.length-2)*t},{x:(s[0].length-2)*t,y:t},{x:(s[0].length-2)*t,y:(s.length-2)*t}],F=()=>{Z(),A()},A=()=>{c.moveProcess(),c.eat();for(let i=0;i<m.length;i++)m[i].moveProcess();c.checkGhostCollision()&&(console.log("hit"),_()),b>=S&&(K(),clearInterval(X))},_=()=>{Y(),T(),k--,k===0&&H()},H=()=>{clearInterval(X),z()},z=()=>{n.font="20px Emulogic",n.fillStyle="white",n.fillText("Game Over!",150,200)},K=()=>{n.font="20px Emulogic",n.fillStyle="white",n.fillText("Winner",150,200)},U=()=>{n.font="20px Emulogic",n.fillStyle="white",n.fillText("Lives: ",220,t*(s.length+1)+10);for(let i=0;i<k;i++)n.drawImage(D,2*t,0,t,t,350+i*t,t*s.length+10,t,t)},J=()=>{for(let i=0;i<s.length;i++)for(let e=0;e<s[0].length;e++)s[i][e]===2&&u(e*t+t/3,i*t+t/3,t/3,t/3,q)},Q=()=>{n.font="20px Emulogic",n.fillStyle="white",n.fillText("Score: "+b,0,t*(s.length+1)+10)},V=()=>{for(let i=0;i<m.length;i++)m[i].draw()},Z=()=>{u(0,0,I.width,I.height,"black"),$(),J(),c.draw(),Q(),V(),U()},X=setInterval(F,1e3/W),$=()=>{for(let i=0;i<s.length;i++)for(let e=0;e<s.length;e++)s[i][e]===1&&(u(e*t,i*t,t,t,j),e>0&&s[i][e-1]===1&&u(e*t,i*t+g,d+g,d,M),e<s[0].length-1&&s[i][e+1]===1&&u(e*t+g,i*t+g,d+g,d,M),i>0&&s[i-1][e]===1&&u(e*t+g,i*t,d,d+g,M),i<s.length-1&&s[i+1][e]===1&&u(e*t+g,i*t+g,d,d+g,M))},Y=()=>{c=new P(t,t,t,t,t/5)},T=()=>{m=[];for(let i=0;i<G;i++){let e=new B(9*t+(i%2===0?0:1)*t,10*t+(i%2===0?0:1)*t,t,t,c.speed/2,R[i%4].x,R[i%4].y,124,116,6+i);m.push(e)}};Y();T();F();window.addEventListener("keydown",i=>{let e=i.keyCode;setTimeout(()=>{e===37||e===65?c.nextDirection=y:e===38||e===87?c.nextDirection=x:e===39||e===68?c.nextDirection=f:(e===40||e===83)&&(c.nextDirection=w)},1)});
